<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Controle de Estoque - Logística OZT</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; font-family:Arial,sans-serif;}
body{background:#f0f4f8;}
.sidebar{position:fixed; left:0; top:0; width:240px; height:100%; background:#064e3b; color:#fff; display:flex; flex-direction:column; padding-top:20px;}
.sidebar h1{text-align:center; margin-bottom:30px; font-size:22px;}
.nav-menu{flex-grow:1; display:flex; flex-direction:column;}
.nav-menu button{background:none; border:none; color:white; padding:14px 20px; text-align:left; font-weight:600; font-size:16px; cursor:pointer; border-left:5px solid transparent; width:100%;}
.nav-menu button:hover, .nav-menu button.active{background:#199e80; border-left:5px solid #ef4444;}
.main-content{margin-left:240px; padding:20px 30px; min-height:100vh;}
h2{text-align:center; color:#064e3b; margin-bottom:20px;}
section{display:none;}
section.active{display:block;}
form{max-width:900px; margin:0 auto 40px auto; background:white; border-radius:8px; padding:20px 30px; box-shadow:0 2px 8px rgba(0,0,0,0.1); display:flex; flex-wrap:wrap; gap:10px; align-items:flex-end;}
.form-group{display:flex; flex-direction:column; flex:1; min-width:120px;}
label{margin-bottom:4px; font-weight:600; font-size:14px;}
input[type="text"], input[type="number"], select{padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px;}
button[type="submit"], .action-btn{background:#059669; border:none; color:white; padding:10px 16px; border-radius:6px; cursor:pointer; font-weight:700;}
button[type="submit"]:hover, .action-btn:hover{background:#047857;}
.btn-group{display:flex; gap:10px;}
table{width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
th, td{padding:10px 12px; text-align:center; border-bottom:1px solid #ddd; font-size:14px;}
th{background:#059669; color:white;}
tr:hover{background:#f3faf7;}
tr.selected{background:#fff1f0; outline:2px solid #ef4444;}
.legend{display:flex; justify-content:center; gap:20px; margin-bottom:15px; flex-wrap:wrap;}
.legend-item{display:flex; align-items:center; gap:8px; font-weight:bold; color:#064e3b;}
.legend-color{width:18px; height:18px; border-radius:4px; display:flex; align-items:center; justify-content:center;}
.legend-color.critico{background:#fde68a;}
.legend-color.baixo{background:#bfdbfe;}
.legend-color.adequado{background:#bbf7d0;}
.legend-color.negativo{background:#fecaca;}
.legend-color input[type="checkbox"]{width:14px; height:14px;}
.hero-image { text-align:center; margin-bottom:20px; }
.hero-image img { max-width:88%; height:auto; border-radius:8px; }
@media (max-width:768px){
.sidebar{position:relative;width:100%;height:auto;flex-direction:row;padding:10px 0;}
.sidebar h1{flex:1;font-size:18px;margin-bottom:0;padding-left:20px;align-self:center;}
.nav-menu{flex-direction:row; flex-wrap:nowrap; overflow-x:auto;}
.nav-menu button{flex:0 0 auto;padding:10px 14px; border-left:none; border-bottom:3px solid transparent;}
.nav-menu button:hover, .nav-menu button.active{border-bottom:3px solid #ef4444; background:transparent;}
.main-content{margin-left:0;padding:15px 10px 40px;}
.hero-image img { max-width:80%; }
}
/* Filtro estoque */
#filtroWrapper{display:flex; gap:10px; align-items:center; margin-bottom:15px;}
#filtroWrapper label{font-weight:600; color:#064e3b;}
#filtroDescricao{padding:8px; font-size:14px; min-width:220px;}
</style>
</head>
<body>
<div class="sidebar">
<h1>Logística OZT</h1>
<nav class="nav-menu">
  <button id="menuInicio" class="active">Início</button>
  <button id="menuCadastro">Cadastro</button>
  <button id="menuEntrada">Entrada</button>
  <button id="menuSaida">Saída</button>
  <button id="menuEstoque">Estoque</button>
</nav>
</div>
<div class="main-content">

<!-- INÍCIO -->
<section id="secInicio" class="active">
  <h2>Bem-vindo ao Controle de Estoque</h2>
  <div class="hero-image">
    <img src="layout.logistica.png" alt="Hero Image" />
  </div>
  <p style="text-align:center;color:#064e3b;">Use o menu para navegar entre Cadastro, Entrada, Saída e Estoque.</p>
</section>

<!-- CADASTRO -->
<section id="secCadastro">
  <h2>Cadastro de Produtos</h2>
  <form id="formCadastroProduto">
    <div class="form-group">
      <label for="codigoProduto">Código</label>
      <input type="text" id="codigoProduto" required>
    </div>
    <div class="form-group">
      <label for="descricaoProduto">Descrição</label>
      <input type="text" id="descricaoProduto" required>
    </div>
    <div class="form-group">
      <label for="unidadeProduto">Unidade</label>
      <select id="unidadeProduto" required>
        <option value="" disabled selected>Selecione</option>
        <option value="UN">UN</option>
        <option value="KG">KG</option>
        <option value="LT">LT</option>
        <option value="CX">CX</option>
        <option value="M">M</option>
        <option value="PCT">PCT</option>
        <option value="SACO">SACO</option>
      </select>
    </div>
    <div class="form-group">
      <label for="categoriaProduto">Categoria</label>
      <select id="categoriaProduto" required>
        <option value="" disabled selected>Selecione</option>
        <option value="Matéria Prima">Matéria Prima</option>
        <option value="Produto Acabado">Produto Acabado</option>
        <option value="Embalagem">Embalagem</option>
        <option value="Nutraceutico">Nutraceutico</option>
        <option value="Bem Star">Bem Star</option>
        <option value="Perfume">Perfume</option>
        <option value="Suplemento">Suplemento</option>
        <option value="Capilar">Capilar</option>
        <option value="Brinde">Brinde</option>
        <option value="Uso geral">Uso geral</option>
        <option value="Outro">Outro</option>
      </select>
    </div>
    <div class="form-group">
      <label for="estoqueMinimoProduto">Estoque Mínimo</label>
      <input type="number" id="estoqueMinimoProduto" min="0" step="0.01" required>
    </div>
    <div class="btn-group">
      <button type="submit">Cadastrar</button>
      <button type="button" id="btnEditar" class="action-btn">Editar</button>
      <button type="button" id="btnExcluir" class="action-btn">Excluir</button>
    </div>
    <p id="msgCadastro" style="margin-top:15px;font-weight:bold;color:#059669;"></p>
  </form>
  <h3>Produtos Cadastrados</h3>
  <table>
    <thead><tr><th>Código</th><th>Descrição</th><th>Unidade</th><th>Categoria</th><th>Estoque Min.</th></tr></thead>
    <tbody id="tabelaProdutos"></tbody>
  </table>
</section>

<!-- ENTRADA -->
<section id="secEntrada">
  <h2>Entradas de Produtos</h2>
  <form id="formEntrada">
    <div class="form-group">
      <label for="produtoEntrada">Produto</label>
      <select id="produtoEntrada" required></select>
    </div>
    <div class="form-group">
      <label for="quantidadeEntrada">Quantidade</label>
      <input type="number" id="quantidadeEntrada" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="localEntrada">Local</label>
      <input type="text" id="localEntrada">
    </div>
    <div class="form-group">
      <label for="tipoEntrada">Tipo</label>
      <select id="tipoEntrada">
        <option value="" disabled selected>Selecione</option>
        <option value="Nota Fiscal">Nota Fiscal</option>
        <option value="Devolução">Devolução</option>
        <option value="Pedido">Pedido</option>
        <option value="O3teck">O3teck</option>
        <option value="EKO">EKO</option>
      </select>
    </div>
    <div class="btn-group">
      <button type="submit">Registrar Entrada</button>
      <button type="button" id="btnEditarEntrada" class="action-btn">Editar</button>
      <button type="button" id="btnExcluirEntrada" class="action-btn">Excluir</button>
    </div>
  </form>
  <h3>Histórico de Entradas</h3>
  <table>
    <thead>
      <tr><th>Código</th><th>Descrição</th><th>Quantidade</th><th>Local</th><th>Tipo</th><th>Data/Hora</th></tr>
    </thead>
    <tbody id="tabelaEntradas"></tbody>
  </table>
</section>

<!-- SAÍDA -->
<section id="secSaida">
  <h2>Saídas de Produtos</h2>
  <form id="formSaida" style="gap:10px;">
    <div class="form-group" style="flex:2;">
      <label for="produtoSaida">Produto</label>
      <select id="produtoSaida" required></select>
    </div>
    <div class="form-group">
      <label for="quantidadeSaida">Quantidade</label>
      <input type="number" id="quantidadeSaida" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="localSaida">Local</label>
      <input type="text" id="localSaida">
    </div>
    <div class="form-group">
      <label for="tipoSaida">Tipo</label>
      <select id="tipoSaida">
        <option value="" disabled selected>Selecione</option>
        <option value="Pedido">Pedido</option>
        <option value="Diretoria">Diretoria</option>
        <option value="Brinde">Brinde</option>
        <option value="Kiko">Kiko</option>
        <option value="Venda Interna">Venda Interna</option>
        <option value="Midia">Midia</option>
        <option value="Garantia">Garantia</option>
        <option value="Defeito">Defeito</option>
        <option value="Amostra">Amostra</option>
        <option value="Reposição Pedido">Reposição Pedido</option>
      </select>
    </div>
    <div class="form-group" style="flex:1;">
      <label for="pedidoSaida">Pedido</label>
      <input type="text" id="pedidoSaida">
    </div>
    <div style="display:flex; gap:10px; flex:1.7;">
      <div class="form-group" style="flex:1;">
        <label for="loteSaida">Lote</label>
        <input type="text" id="loteSaida">
      </div>
      <div class="form-group" style="flex:1;">
        <label for="validadeSaida">Validade</label>
        <input type="text" id="validadeSaida">
      </div>
    </div>
    <div class="btn-group" style="margin-left:auto; align-self:flex-end;">
      <button type="submit">Registrar Saída</button>
      <button type="button" id="btnEditarSaida" class="action-btn">Editar</button>
      <button type="button" id="btnExcluirSaida" class="action-btn">Excluir</button>
    </div>
  </form>
  <h3>Histórico de Saídas</h3>
  <table>
    <thead>
      <tr>
        <th>Código</th><th>Descrição</th><th>Quantidade</th><th>Local</th>
        <th>Pedido</th><th>Lote</th><th>Validade</th><th>Tipo</th><th>Data/Hora</th>
      </tr>
    </thead>
    <tbody id="tabelaSaidas"></tbody>
  </table>
</section>

<!-- ESTOQUE -->
<section id="secEstoque">
  <h2>Estoque Atual</h2>
  <div id="filtroWrapper">
    <button id="btnRelatorio" class="action-btn">Gerar Relatório</button>
    <label for="filtroDescricao">Pesquisar estoque</label>
    <select id="filtroDescricao"></select>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-color critico"></div>Estoque Crítico</div>
    <div class="legend-item"><div class="legend-color baixo"></div>Estoque Baixo</div>
    <div class="legend-item"><div class="legend-color adequado"></div>Estoque Adequado</div>
    <div class="legend-item"><div class="legend-color negativo"></div>Estoque Negativo</div>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-color critico"><input type="checkbox" id="filtroCritico" checked></div>Crítico</div>
    <div class="legend-item"><div class="legend-color baixo"><input type="checkbox" id="filtroBaixo" checked></div>Baixo</div>
    <div class="legend-item"><div class="legend-color adequado"><input type="checkbox" id="filtroAdequado" checked></div>Adequado</div>
    <div class="legend-item"><div class="legend-color negativo"><input type="checkbox" id="filtroNegativo" checked></div>Negativo</div>
  </div>
  <table>
    <thead>
      <tr><th>Código</th><th>Descrição</th><th>Categoria</th><th>Unidade</th><th>Qtd Atual</th><th>Estoque Min</th><th>Status</th></tr>
    </thead>
    <tbody id="tabelaEstoque"></tbody>
  </table>
</section>

<div id="relatorioImpressao" style="display:none;"></div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{
let produtos=JSON.parse(localStorage.getItem("produtos")||"[]");
let entradas=JSON.parse(localStorage.getItem("entradas")||"[]");
let saidas=JSON.parse(localStorage.getItem("saidas")||"[]");
let editIndexProduto=null, editIndexEntrada=null, editIndexSaida=null;

const botoesMenu={"menuInicio":"secInicio","menuCadastro":"secCadastro","menuEntrada":"secEntrada","menuSaida":"secSaida","menuEstoque":"secEstoque"};
for(const [btnId,secId] of Object.entries(botoesMenu)){
document.getElementById(btnId).addEventListener("click",()=>{
document.querySelectorAll("section").forEach(sec=>sec.classList.remove("active"));
document.querySelectorAll(".nav-menu button").forEach(b=>b.classList.remove("active"));
document.getElementById(secId).classList.add("active");
document.getElementById(btnId).classList.add("active");
atualizarTabelaProdutos();
atualizarTabelaEntradas();
atualizarTabelaSaidas();
atualizarEstoqueTabela();
});
}

const tabelaProdutos=document.getElementById("tabelaProdutos");
const tabelaEntradas=document.getElementById("tabelaEntradas");
const tabelaSaidas=document.getElementById("tabelaSaidas");
const tabelaEstoque=document.getElementById("tabelaEstoque");
const formCadastroProduto=document.getElementById("formCadastroProduto");
const formEntrada=document.getElementById("formEntrada");
const formSaida=document.getElementById("formSaida");
const msgCadastro=document.getElementById("msgCadastro");
const filtroDescricao=document.getElementById("filtroDescricao");

function selecionarLinha(tabela){
tabela.querySelectorAll("tr").forEach(tr=>{
tr.addEventListener("click",()=>{
tabela.querySelectorAll("tr").forEach(r=>r.classList.remove("selected"));
tr.classList.add("selected");
});
});
}

function atualizarTabelaProdutos(){
tabelaProdutos.innerHTML=produtos.map((p,i)=>`<tr data-index="${i}"><td>${p.codigo}</td><td>${p.descricao}</td><td>${p.unidade}</td><td>${p.categoria}</td><td>${p.estoqueMinimo}</td></tr>`).join("");
atualizarSelectsProdutos();
atualizarFiltroDescricao();
selecionarLinha(tabelaProdutos);
}

function atualizarSelectsProdutos(){
[document.getElementById("produtoEntrada"),document.getElementById("produtoSaida")].forEach(sel=>{
sel.innerHTML='<option value="" disabled selected>Selecione</option>';
produtos.forEach(p=>{
const opt=document.createElement("option");
opt.value=p.codigo; opt.textContent=`${p.codigo} - ${p.descricao}`;
sel.appendChild(opt);
});
});
}

function atualizarFiltroDescricao(){
filtroDescricao.innerHTML='<option value="">Filtrar por descrição</option>';
produtos.forEach(p=>{
const opt=document.createElement("option");
opt.value=p.descricao; opt.textContent=p.descricao;
filtroDescricao.appendChild(opt);
});
}

function atualizarTabelaEntradas(){
tabelaEntradas.innerHTML=entradas.map((e,i)=>`<tr data-index="${i}"><td>${e.codigo}</td><td>${e.descricao}</td><td>${e.quantidade}</td><td>${e.local}</td><td>${e.tipo}</td><td>${e.data}</td></tr>`).join("");
selecionarLinha(tabelaEntradas);
}

function atualizarTabelaSaidas(){
tabelaSaidas.innerHTML=saidas.map((s,i)=>`<tr data-index="${i}"><td>${s.codigo}</td><td>${s.descricao}</td><td>${s.quantidade}</td><td>${s.local}</td><td>${s.pedido}</td><td>${s.lote}</td><td>${s.validade}</td><td>${s.tipo}</td><td>${s.data}</td></tr>`).join("");
selecionarLinha(tabelaSaidas);
}

function atualizarEstoqueTabela(){
let descricaoFiltro=filtroDescricao.value;
tabelaEstoque.innerHTML=produtos.map(p=>{
let qtdAtual=entradas.filter(e=>e.codigo===p.codigo).reduce((a,b)=>a+b.quantidade,0)-saidas.filter(s=>s.codigo===p.codigo).reduce((a,b)=>a+b.quantidade,0);
let status="Adequado";
if(qtdAtual<0)status="Negativo"; else if(qtdAtual<=p.estoqueMinimo*0.5)status="Crítico"; else if(qtdAtual<=p.estoqueMinimo)status="Baixo";
if(descricaoFiltro && p.descricao!==descricaoFiltro)return "";
return `<tr data-codigo="${p.codigo}" data-status="${status}"><td>${p.codigo}</td><td>${p.descricao}</td><td>${p.categoria}</td><td>${p.unidade}</td><td>${qtdAtual}</td><td>${p.estoqueMinimo}</td><td>${status}</td></tr>`;
}).join("");
aplicarFiltroEstoque();
selecionarLinha(tabelaEstoque);
}

function aplicarFiltroEstoque(){
const filtroCritico=document.getElementById("filtroCritico").checked;
const filtroBaixo=document.getElementById("filtroBaixo").checked;
const filtroAdequado=document.getElementById("filtroAdequado").checked;
const filtroNegativo=document.getElementById("filtroNegativo").checked;
tabelaEstoque.querySelectorAll("tr").forEach(tr=>{
const status=tr.dataset.status;
tr.style.display=(status==="Crítico"&&filtroCritico)||(status==="Baixo"&&filtroBaixo)||(status==="Adequado"&&filtroAdequado)||(status==="Negativo"&&filtroNegativo)?"":"none";
});
}

["filtroCritico","filtroBaixo","filtroAdequado","filtroNegativo"].forEach(id=>document.getElementById(id).addEventListener("change",atualizarEstoqueTabela));
filtroDescricao.addEventListener("change",atualizarEstoqueTabela);

// CADASTRO PRODUTO
formCadastroProduto.addEventListener("submit",e=>{
e.preventDefault();
const produto={
codigo:document.getElementById("codigoProduto").value,
descricao:document.getElementById("descricaoProduto").value,
unidade:document.getElementById("unidadeProduto").value,
categoria:document.getElementById("categoriaProduto").value,
estoqueMinimo:parseFloat(document.getElementById("estoqueMinimoProduto").value)
};
if(editIndexProduto!==null){produtos[editIndexProduto]=produto; editIndexProduto=null;} else {produtos.push(produto);}
localStorage.setItem("produtos",JSON.stringify(produtos));
formCadastroProduto.reset(); msgCadastro.textContent="Produto salvo com sucesso!";
atualizarTabelaProdutos();
});

// EDITAR/EXCLUIR PRODUTO
document.getElementById("btnEditar").addEventListener("click",()=>{
const tr=tabelaProdutos.querySelector("tr.selected");
if(!tr)return alert("Selecione um produto na tabela para editar.");
editIndexProduto=parseInt(tr.dataset.index);
const p=produtos[editIndexProduto];
document.getElementById("codigoProduto").value=p.codigo;
document.getElementById("descricaoProduto").value=p.descricao;
document.getElementById("unidadeProduto").value=p.unidade;
document.getElementById("categoriaProduto").value=p.categoria;
document.getElementById("estoqueMinimoProduto").value=p.estoqueMinimo;
});

document.getElementById("btnExcluir").addEventListener("click",()=>{
const tr=tabelaProdutos.querySelector("tr.selected");
if(!tr)return alert("Selecione um produto na tabela para excluir.");
if(!confirm("Deseja realmente excluir este produto?"))return;
const index=parseInt(tr.dataset.index);
produtos.splice(index,1);
localStorage.setItem("produtos",JSON.stringify(produtos));
atualizarTabelaProdutos();
atualizarTabelaEntradas();
atualizarTabelaSaidas();
atualizarEstoqueTabela();
});

// CADASTRO ENTRADA
formEntrada.addEventListener("submit",e=>{
e.preventDefault();
const cod=document.getElementById("produtoEntrada").value;
const prod=produtos.find(p=>p.codigo===cod);
if(!prod)return alert("Produto inválido");
const entrada={
codigo:prod.codigo,
descricao:prod.descricao,
quantidade:parseFloat(document.getElementById("quantidadeEntrada").value),
local:document.getElementById("localEntrada").value,
tipo:document.getElementById("tipoEntrada").value,
data:new Date().toLocaleString()
};
if(editIndexEntrada!==null){entradas[editIndexEntrada]=entrada; editIndexEntrada=null;} else entradas.push(entrada);
localStorage.setItem("entradas",JSON.stringify(entradas));
formEntrada.reset(); atualizarTabelaEntradas(); atualizarEstoqueTabela();
});

// EDITAR/EXCLUIR ENTRADA
document.getElementById("btnEditarEntrada").addEventListener("click",()=>{
const tr=tabelaEntradas.querySelector("tr.selected");
if(!tr)return alert("Selecione uma entrada para editar.");
editIndexEntrada=parseInt(tr.dataset.index);
const e=entradas[editIndexEntrada];
document.getElementById("produtoEntrada").value=e.codigo;
document.getElementById("quantidadeEntrada").value=e.quantidade;
document.getElementById("localEntrada").value=e.local;
document.getElementById("tipoEntrada").value=e.tipo;
});

document.getElementById("btnExcluirEntrada").addEventListener("click",()=>{
const tr=tabelaEntradas.querySelector("tr.selected");
if(!tr)return alert("Selecione uma entrada para excluir.");
if(!confirm("Deseja realmente excluir esta entrada?"))return;
const idx=parseInt(tr.dataset.index);
entradas.splice(idx,1);
localStorage.setItem("entradas",JSON.stringify(entradas));
atualizarTabelaEntradas();
atualizarEstoqueTabela();
});

// CADASTRO SAÍDA
formSaida.addEventListener("submit",e=>{
e.preventDefault();
const cod=document.getElementById("produtoSaida").value;
const prod=produtos.find(p=>p.codigo===cod);
if(!prod)return alert("Produto inválido");
const saida={
codigo:prod.codigo,
descricao:prod.descricao,
quantidade:parseFloat(document.getElementById("quantidadeSaida").value),
local:document.getElementById("localSaida").value,
pedido:document.getElementById("pedidoSaida").value,
lote:document.getElementById("loteSaida").value,
validade:document.getElementById("validadeSaida").value,
tipo:document.getElementById("tipoSaida").value,
data:new Date().toLocaleString()
};
if(editIndexSaida!==null){saidas[editIndexSaida]=saida; editIndexSaida=null;} else saidas.push(saida);
localStorage.setItem("saidas",JSON.stringify(saidas));
formSaida.reset(); atualizarTabelaSaidas(); atualizarEstoqueTabela();
});

// EDITAR/EXCLUIR SAÍDA
document.getElementById("btnEditarSaida").addEventListener("click",()=>{
const tr=tabelaSaidas.querySelector("tr.selected");
if(!tr)return alert("Selecione uma saída para editar.");
editIndexSaida=parseInt(tr.dataset.index);
const s=saidas[editIndexSaida];
document.getElementById("produtoSaida").value=s.codigo;
document.getElementById("quantidadeSaida").value=s.quantidade;
document.getElementById("localSaida").value=s.local;
document.getElementById("pedidoSaida").value=s.pedido;
document.getElementById("loteSaida").value=s.lote;
document.getElementById("validadeSaida").value=s.validade;
document.getElementById("tipoSaida").value=s.tipo;
});

document.getElementById("btnExcluirSaida").addEventListener("click",()=>{
const tr=tabelaSaidas.querySelector("tr.selected");
if(!tr)return alert("Selecione uma saída para excluir.");
if(!confirm("Deseja realmente excluir esta saída?"))return;
const idx=parseInt(tr.dataset.index);
saidas.splice(idx,1);
localStorage.setItem("saidas",JSON.stringify(saidas));
atualizarTabelaSaidas();
atualizarEstoqueTabela();
});

// RELATÓRIO DINÂMICO
document.getElementById("btnRelatorio").addEventListener("click",()=>{
let rel="<table border='1' style='width:100%;border-collapse:collapse;text-align:center;'><thead><tr><th>Código</th><th>Descrição</th><th>Categoria</th><th>Unid.</th><th>Qtd Atual</th><th>Estoque Min</th><th>Status</th></tr></thead><tbody>";
produtos.forEach(p=>{
let qtdAtual=entradas.filter(e=>e.codigo===p.codigo).reduce((a,b)=>a+b.quantidade,0)-saidas.filter(s=>s.codigo===p.codigo).reduce((a,b)=>a+b.quantidade,0);
let status="Adequado";
if(qtdAtual<0)status="Negativo"; else if(qtdAtual<=p.estoqueMinimo*0.5)status="Crítico"; else if(qtdAtual<=p.estoqueMinimo)status="Baixo";
rel+=`<tr><td>${p.codigo}</td><td>${p.descricao}</td><td>${p.categoria}</td><td>${p.unidade}</td><td>${qtdAtual}</td><td>${p.estoqueMinimo}</td><td>${status}</td></tr>`;
});
rel+="</tbody></table>";
const w=window.open(""); w.document.write("<h2>Relatório de Estoque</h2>"+rel);
});

atualizarTabelaProdutos();
atualizarTabelaEntradas();
atualizarTabelaSaidas();
atualizarEstoqueTabela();
});
</script>
</div>
</body>
</html>
